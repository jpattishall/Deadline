<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Deadline</title>
    <link href="https://fonts.googleapis.com/css?family=Comfortaa|Coming+Soon" rel="stylesheet">
    <link rel="stylesheet" href="Styles/main.css">
    <link rel="stylesheet" href="Styles/notes.css">
    <link rel="stylesheet" href="Styles/conversation.css">
    <link rel="stylesheet" href="Styles/contacts.css">
    <link rel="stylesheet" href="Styles/controls.css">
    <link rel="stylesheet" href="Scripts/Plugins/jquery-ui/jquery-ui.min.css">
    <script src="Scripts/index.js"></script>
    <script src="Scripts/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="Scripts/Sources/Contacts.js"></script>
    <script src="Scripts/Managers/UI/ContactPanelManager.js"></script>
    <script type="text/javascript" src="Scripts/Objects/Terminal.js"></script>
    <script src="Scripts/Plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="Scripts/Sources/Story.js"></script>
    <script src="Scripts/App.js"></script>
</head>

<body>
    <div class="content">
        <h1>Deadline</h1>
        <div class="story">
            <div class="story-notes">
                <div class="story-notes-header">Bloc*Notes</div>
                <div class="story-notes-container">
                    <div class="story-notes-note">Called Lyle Skyton; Immediately got voicemail.</div>
                    <div class="story-notes-note">Called Lyle Skyton; Immediately got voicemail.</div>
                    <div class="story-notes-note">Called Lyle Skyton; No pick up...</div>
                    <div class="story-notes-note">"Odd weather pattern in Gulf of Mexico" - Lyle</div>
                    <div class="story-notes-note">Called Lyle Skyton at National Weather Service</div>
                    <div class="story-notes-note">Called Lyle Skyton at National Weather Service</div>
                    <div class="story-notes-note">Called Lyle Skyton at National Weather Service</div>
                    <div class="story-notes-note">Called Lyle Skyton at National Weather Service</div>
                </div>
            </div>
            <div class="story-terminal">
                <div class="story-conversation"></div>
                <div class="story-terminal-glow"></div>
                <div class="story-terminal-scanlines"></div>
            </div>
            <div class="story-contacts">
                <div class="story-contacts-header">Rolodex</div>
                <div id="panelContent" class="story-contacts-content"></div>
            </div>
        </div>
        <div class="story-controls">
            <div class="story-controls-container" style="display: flex; align-items: center; justify-content: center">
                <!-- <button id="clear-terminal" style="height: 50px; border-radius: 8px;">Clear Terminal</button>
                <button id="prompt-log-terminal" style="height: 50px; border-radius: 8px; margin: 0 16px;">Send message to Terminal</button> -->
                <button id="toggle-terminal-animation" style="height: 50px; border-radius: 8px">Toggle Terminal Animations</button>
                <button id="make-a-call" style="height: 50px; border-radius: 8px">Phone</button>
                <div id="conversation-options">

                </div>
            </div>
        </div>
    </div>
    <script>
        // Game scope
        {
            let terminal = new Terminal({ element: document.querySelector('.story-conversation') });
            let newGame;

            document.addEventListener('DOMContentLoaded', e => {
                InitializePage();
            });

            function InitializePage() {
                loadDemo();
                StartGame();
                bindUiFunctions();
            }

            function loadDemo() {
                let initConvo = [
                    { message: 'Hello?', type: 'contact', typingSpeed: 1000 / 5 },
                    { message: 'How dark is the sky overhead?', type: 'player', typingSpeed: 1000 / 30 },
                    { message: 'I don\'t know. We\'ve gone into the basement, the building has been evacuated...', type: 'contact', typingSpeed: 1000 / 15, initialDelay: 200 },
                    { message: 'ERR: Call Disconnected! Ref #08419495021', type: 'system', initialDelay: 500, typingSpeed: 1000 / 80 }
                ];

                initConvo.forEach(msg => {
                    terminal.write(msg);
                });

                document.querySelector('#toggle-terminal-animation').addEventListener('click', e => {
                    ['.story-terminal-glow', '.story-terminal-scanlines', '.story-conversation'].forEach(selector => {
                        document.querySelector(selector).classList.toggle('story-conversation--disable-animation');
                    })
                });
            }

            function StartGame() {
                const contactPanelManager = new ContactPanelManager("panelContent");
                const args = {
                    contactPanelManager: contactPanelManager,
                    contacts: Contacts,
                    story: new Story(),
                    terminal: terminal
                };
            
                newGame = new Game(args);
                newGame.start();
            }

            function bindUiFunctions(){
                document.querySelector('#make-a-call').addEventListener('click', e => {
                    var prompt = window.prompt('Enter phone number:');
                    newGame.call(prompt);
                });
            }
        }
    </script>
</body>

</html>